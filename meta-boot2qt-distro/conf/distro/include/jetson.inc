############################################################################
##
## Copyright (C) 2022 The Qt Company Ltd.
## Contact: https://www.qt.io/licensing/
##
## This file is part of the Boot to Qt meta layer.
##
## $QT_BEGIN_LICENSE:GPL$
## Commercial License Usage
## Licensees holding valid commercial Qt licenses may use this file in
## accordance with the commercial license agreement provided with the
## Software or, alternatively, in accordance with the terms contained in
## a written agreement between you and The Qt Company. For licensing terms
## and conditions see https://www.qt.io/terms-conditions. For further
## information use the contact form at https://www.qt.io/contact-us.
##
## GNU General Public License Usage
## Alternatively, this file may be used under the terms of the GNU
## General Public License version 3 or (at your option) any later version
## approved by the KDE Free Qt Foundation. The licenses are as published by
## the Free Software Foundation and appearing in the file LICENSE.GPL3
## included in the packaging of this file. Please review the following
## information to ensure the GNU General Public License requirements will
## be met: https://www.gnu.org/licenses/gpl-3.0.html.
##
## $QT_END_LICENSE$
##
############################################################################

# without the distro_bootpart that's not supported by stock u-boot
KERNEL_ROOTSPEC = "root=/dev/mmcblk${devnum}p1 rw rootwait"
KERNEL_ROOTSPEC:jetson-nano-2gb-devkit = "root=/dev/mmcblk0p1 rw rootwait"
KERNEL_ROOTSPEC:jetson-nano-devkit = "root=/dev/mmcblk0p1 rw rootwait"

INITRAMFS_MAXSIZE = "165888"
IMAGE_ROOTFS_ALIGNMENT = "1024"
UBOOT_SUFFIX = "bin"

IMAGE_FSTYPES += "wic.xz"
WKS_FILE = "tegra-bootdisk.wks.in"

DEPLOY_CONF_NAME:jetson-tx1-devkit = "NVIDIA Jetson TX1 Development Kit"
DEPLOY_CONF_NAME:jetson-tx2-devkit = "NVIDIA Jetson TX2 Development Kit"
DEPLOY_CONF_NAME:jetson-agx-xavier-devkit = "NVIDIA Jetson AGX Xavier Development Kit"

DEPLOY_CONF_IMAGE_TYPE = "wic.xz"

IMAGE_CLASSES += "image_types_tegra_b2qt"

QBSP_IMAGE_CONTENT += "\
    ${IMAGE_LINK_NAME}.${DEPLOY_CONF_IMAGE_TYPE} \
    ${IMAGE_LINK_NAME}.conf \
    ${IMAGE_LINK_NAME}.info \
    ${IMAGE_LINK_NAME}.tegraflash.tar.gz \
    "

# NVIDIA's Vulkan support is for X only
DISTRO_FEATURES:remove = "vulkan"

# https://github.com/madisongh/meta-tegra/issues/236
KERNEL_MODULE_AUTOLOAD:remove = "tegra-udrm"
KERNEL_MODULE_PROBECONF:remove = "tegra-udrm"
module_conf_tegra-udrm = ""

NVIDIA_DEVNET_MIRROR ?= "file://${BSPDIR}/sources/nvidia-devnet-mirror"
NVIDIA_DEVNET_MIRROR[vardepsexclude] = "BSPDIR"

# cboot-t18x fails to build with:
# multiple definition of `sdmmc_context_t'
PREFERRED_PROVIDER_cboot = "cboot-prebuilt"

require conf/include/gstreamer-1.14.conf
